<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Custom Invoice Generator</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- SheetJS, jsPDF + AutoTable, JSZip, FileSaver -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.27/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.0/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <style>
    body { padding-top: 4rem; background: #f8f9fa; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container d-flex justify-content-center">
    <div class="w-50" style="max-width:600px;">

      <!-- Unlock Page -->
      <div id="unlockPage" class="card shadow-sm mb-4">
        <div class="card-body p-4 text-center">
          <h1 class="card-title mb-4">Enter Unlock Code</h1>
          <input type="text" id="unlockInput" class="form-control mb-3" placeholder="Enter unlock code">
          <button id="unlockBtn" class="btn btn-primary w-100 mb-3">Unlock</button>
          <div id="unlockAlert"></div>

          <div class="mt-3 d-flex justify-content-center gap-3">
            <a href="YOUTUBE_URL" target="_blank" class="d-flex align-items-center text-decoration-none">
              <i class="bi bi-youtube fs-4 text-danger"></i><span class="ms-2">See instructions</span>
            </a>
            <a href="https://wa.me/8801610926927" target="_blank" class="d-flex align-items-center text-decoration-none">
              <i class="bi bi-whatsapp fs-4 text-success"></i><span class="ms-2">Contact us</span>
            </a>
          </div>

          <div class="accordion mt-4" id="unlockInfoAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingUnlockInfo">
                <button class="accordion-button collapsed" type="button"
                  data-bs-toggle="collapse" data-bs-target="#collapseUnlockInfo"
                  aria-expanded="false" aria-controls="collapseUnlockInfo">
                  How to get Unlock Code?
                </button>
              </h2>
              <div id="collapseUnlockInfo" class="accordion-collapse collapse"
                   aria-labelledby="headingUnlockInfo" data-bs-parent="#unlockInfoAccordion">
                <div class="accordion-body text-start">
                  এক্টিভেশন কোড পেতে ০১৬১০৯২৬৯২৭ নম্বরে বিকাশের মাধ্যমে ১৯৯ টাকা সেন্ড মানি করুন।
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Generator Page -->
      <div id="generatorPage" class="hidden">
        <div class="card shadow-sm mb-4">
          <div class="card-body p-4">
            <h1 class="card-title text-center mb-4">Invoice Generator</h1>

            <!-- Paper Size -->
            <div class="mb-3 row">
              <label class="col-sm-4 col-form-label">Paper Size</label>
              <div class="col-sm-8">
                <select id="presetSize" class="form-select">
                  <option value="210,297,mm">A4 Portrait</option>
                  <option value="210,148.5,mm">Half A4 Portrait</option>
                </select>
              </div>
            </div>

            <!-- Optional Date -->
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="showDate" checked>
              <label class="form-check-label" for="showDate">Print Invoice Date</label>
            </div>

            <!-- Inputs -->
            <div class="mb-2">
              <label class="form-label">Upload Logo</label>
              <input type="file" id="headerInput" class="form-control" accept="image/*">
            </div>
            <div class="mb-2">
              <label class="form-label">Footer Text (optional)</label>
              <textarea id="footerText" class="form-control" rows="2"
                placeholder="Enter footer text (use / for line breaks)"></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">Footer QR/Image (optional)</label>
              <input type="file" id="footerInput" class="form-control" accept="image/*">
            </div>
            <div class="mb-2">
              <label class="form-label">Excel File (template)</label>
              <input type="file" id="excelInput" class="form-control" accept=".xls,.xlsx">
            </div>
            <div id="invoiceSelection" class="mb-2 hidden">
              <label class="form-label">Select Invoices</label>
              <select id="invoiceSelect" class="form-select" multiple size="8"></select>
            </div>
            <button type="button" id="generateBtn" class="btn btn-primary w-100 mt-2">
              Generate Invoices
            </button>
            <div id="alertPlaceholder" class="mt-3"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const { jsPDF } = window.jspdf;

  // Unlock handler (unchanged) …
  document.getElementById('unlockBtn').addEventListener('click', async () => {
    /* … your unlock code … */
  });

  // Excel parsing (unchanged) …
  let parsedRows = [];
  document.getElementById('excelInput').addEventListener('change', async e => {
    /* … your parsing code … */
  });

  // Image loader helper (unchanged) …
  const loadImage = file => new Promise(res => {
    /* … your FileReader code … */
  });

  // Generate button
  document.getElementById('generateBtn').addEventListener('click', async () => {
    /* … your preamble (logo, sheets, sizing) … */

    // after computing `bodyRows`, `w`, `h`, `pad` and setting `y`:

    // 1) draw a top rule above the header
    const lineX1 = pad, lineX2 = w - pad;
    // we'll draw it at y - 2
    doc.setLineWidth(0.8);
    doc.line(lineX1, y - 2, lineX2, y - 2);

    // 2) render the table itself, no borders
    doc.autoTable({
      head: [['Item','Qty','Price','Line Total']],
      body: bodyRows,
      startY: y,
      theme: 'plain',
      styles: { cellPadding: 2 },
      columnStyles: {
        // Item left‑aligned, others centered
        1: { halign: 'center' },
        2: { halign: 'center' },
        3: { halign: 'center' }
      }
    });

    // 3) draw a bottom rule under the header row
    const headEnd = doc.autoTable.previous.finalY - doc.autoTable.previous.table.height 
                  + doc.autoTable.previous.headHeight;
    doc.setLineWidth(0.8);
    doc.line(lineX1, headEnd + pad*0.2, lineX2, headEnd + pad*0.2);

    // advance y past the entire table
    y = doc.autoTable.previous.finalY + 10;

    // 4) before printing subtotal, draw a thin divider
    doc.setLineWidth(0.2);
    doc.line(lineX1, y - 5, lineX2, y - 5);

    // 5) render your Subtotal / Discount / Grand Total as before
    doc.setFontSize(10);
    doc.text('Subtotal:', lineX1, y);
    doc.text(subTotal.toFixed(2), lineX2, y, { align: 'right' });
    y += 6;
    doc.text('Discount:', lineX1, y);
    doc.text(discount.toFixed(2), lineX2, y, { align: 'right' });
    y += 6;
    doc.setFont('helvetica', 'bold');
    doc.text('Grand Total:', lineX1, y);
    doc.text(grand.toFixed(2), lineX2, y, { align: 'right' });
    doc.setFont('helvetica', 'normal');

    // … your footer, zipping, and download code …
  });
});
</script>


 
   

</body>
</html>
